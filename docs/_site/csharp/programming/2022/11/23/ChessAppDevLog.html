<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous"> <link rel="stylesheet" href="/assets/main.css"> <link rel="canonical" href="http://localhost:4000/csharp/programming/2022/11/23/ChessAppDevLog.html"> <link rel="alternate" type="application/rss+xml" title="World&#39;s Worst Blog" href="/feed.xml"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Refactoring a Chess Program in C# | World’s Worst Blog</title> <meta name="generator" content="Jekyll v3.9.2" /> <meta property="og:title" content="Refactoring a Chess Program in C#" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="I want to take you with me on a journey in which I refactor a Chess program that was written by a novice coder. The original source code is spaghetti code with the majority of the functionality crammed into a single main method. But, I really do not want to judge the original code. We have all been there at one point or another, especially in the early stages of learning." /> <meta property="og:description" content="I want to take you with me on a journey in which I refactor a Chess program that was written by a novice coder. The original source code is spaghetti code with the majority of the functionality crammed into a single main method. But, I really do not want to judge the original code. We have all been there at one point or another, especially in the early stages of learning." /> <link rel="canonical" href="http://localhost:4000/csharp/programming/2022/11/23/ChessAppDevLog.html" /> <meta property="og:url" content="http://localhost:4000/csharp/programming/2022/11/23/ChessAppDevLog.html" /> <meta property="og:site_name" content="World’s Worst Blog" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2022-11-23T07:13:00-07:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Refactoring a Chess Program in C#" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-23T07:13:00-07:00","datePublished":"2022-11-23T07:13:00-07:00","description":"I want to take you with me on a journey in which I refactor a Chess program that was written by a novice coder. The original source code is spaghetti code with the majority of the functionality crammed into a single main method. But, I really do not want to judge the original code. We have all been there at one point or another, especially in the early stages of learning.","headline":"Refactoring a Chess Program in C#","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/csharp/programming/2022/11/23/ChessAppDevLog.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/imgs/logo.png"}},"url":"http://localhost:4000/csharp/programming/2022/11/23/ChessAppDevLog.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <header id="nav-header" class="border-dark border-left-0 border-right-0"> <div id="nav-container" class="container position-relative d-flex justify-content-between align-items-center"> <a class="h4 m-0 text-dark" href="/"> <img src="/imgs/logo.png" width="32px" height="32px"/> World&#39;s Worst Blog </a> <nav id="nav-menu-container" class="text-right navbar-light"> <input type="checkbox" id="nav-trigger" class="d-none"/> <label for="nav-trigger" aria-label="button" class="m-2 d-inline-block d-md-none navbar-toggler-icon"> </label> <div id="nav-menu" class="d-none d-md-block"> <a class="text-dark ml-3 ml-md-0 p-2 d-block d-md-inline-block" href="/about/">About</a> </div> </nav> </div> </header> <main aria-label="Content"> <div id="content-container" class="container"> <article itemscope itemtype="http://schema.org/BlogPosting"> <header class="pt-4 pb-3"> <h1 itemprop="name headline">Refactoring a Chess Program in C#</h1> <p class="text-secondary"> <time datetime="2022-11-23T07:13:00-07:00" itemprop="datePublished"> Nov 23, 2022 </time> </p> </header> <div class="text-justify" itemprop="articleBody" id="content"> <p>I want to take you with me on a journey in which I refactor a Chess program that was written by a novice coder. The original source code is spaghetti code with the majority of the functionality crammed into a single main method. But, I really do not want to judge the original code. We have all been there at one point or another, especially in the early stages of learning.</p> <p>Honestly, I have always wanted to program a Chess game but have never managed to put in the time to do it. So, let me start by saying that I think it is amazing that there is a person out there who decided to tackle this as a first project!</p> <p>Second, a huge amount of kudos to anyone willing to post their code on the Internet and ask for help.</p> <p>And finally, a huge thanks to <strong>u/RayanWIP</strong> for giving me permission to dissect their code on my live stream, create a tutorial video, and write up this article.</p> <p>So… let’s get to it!</p> <h1 id="tldr">tl;dr;</h1> <p>I never intended to write so many words… but here we are.</p> <p>The 10 second version: I took a Chess program with a 700-ish line <strong>Main</strong> method, <a href="https://github.com/jcollard/Chessapp/tree/pre-refactor">Link to Original</a>, and did my best to refactor it into code that uses an Object Oriented design: <a href="https://github.com/jcollard/Chessapp/tree/oo-refactor-part5">Link to Result</a>.</p> <p>I live streamed the entire refactor so I could go back and chop it into a tutorial video (pending creation). This article goes into the details of my experience with that refactor.</p> <p>You can watch the full (unabridged) live stream here:<a href="https://www.youtube.com/watch?v=ZAEtUKu3Q-4&amp;list=PLBdNYhNqW67lfpwfIJ1ne_l4cHtuAHU6g">LINK</a></p> <p>And now the long version…</p> <h1 id="table-of-contents">Table of Contents</h1> <ul> <li><a href="#tldr">tl;dr;</a></li> <li><a href="#table-of-contents">Table of Contents</a></li> <li><a href="#the-original-post">The original post</a></li> <li><a href="#my-response">My Response</a></li> <li><a href="#how-i-got-here">How I got here</a></li> <li><a href="#overview-of-the-refactor">Overview of the Refactor</a></li> <li><a href="#part-1-building-an-input--output-test">Part 1: Building an Input / Output Test</a> <ul> <li><a href="#the-plan">The Plan</a></li> <li><a href="#creating-input-tests">Creating Input Tests</a></li> <li><a href="#replaying-the-game">Replaying the Game</a></li> <li><a href="#problems-creating-output-files">Problems Creating Output Files</a></li> </ul> </li> <li><a href="#part-2-extracting-local-functions">Part 2: Extracting Local Functions</a></li> <li><a href="#part-3-moving-to-an-object-oriented-design">Part 3: Moving to an Object Oriented Design</a> <ul> <li><a href="#the-ipiece-interface">The IPiece Interface</a></li> <li><a href="#the-abstractpiece-class">The AbstractPiece Class</a></li> <li><a href="#refactoring-logic-checks">Refactoring Logic Checks</a></li> <li><a href="#refactoring-sublogic-for-each-piece">Refactoring SubLogic for each Piece</a> <ul> <li><a href="#king">King</a></li> <li><a href="#knight">Knight</a></li> <li><a href="#rook-bishop-and-queen">Rook, Bishop, and Queen</a></li> <li><a href="#pawn">Pawn</a></li> </ul> </li> </ul> </li> <li><a href="#part-4-removing-global-variables">Part 4: Removing Global Variables</a></li> <li><a href="#last-thoughts--whats-next">Last Thoughts / What’s next?</a></li> </ul> <h1 id="the-original-post">The original post</h1> <p>A few days ago a user by the name of <strong>/u/RayanWIP</strong> shared a console based Chess program they had written on <a href="https://www.reddit.com/r/learncsharp/">/r/learncsharp</a> and asked for advice on how they should test for bugs:</p> <p><img src="/imgs/2022-11-23-ChessApp/original-post.png" alt="Image" /></p> <p>Here is a <a href="https://www.reddit.com/r/learncsharp/comments/yvk2xe/finished_my_first_app_but_unsure_how_to_test_for/">Link to the Original Post</a></p> <p>There were only a few comments and only two stood out to me:</p> <p>The first gave me a chuckle:</p> <p><img src="/imgs/2022-11-23-ChessApp/users-find-bugs.png" alt="Users Find Bugs" /></p> <p>Then… it sunk in a little bit that this feels too true for many projects (including my own). Unfortunately, I don’t think this comment is particularly helpful when your user base is essentially 1 (yourself).</p> <p>The second recommended doing some research into software testing terms:</p> <p><img src="/imgs/2022-11-23-ChessApp/unit-testing.png" alt="Testing Terms" /></p> <p>Although short, this response felt reasonable and to the point. When I first saw the post, I planned to write something similar.</p> <p>Anyone who knows me, knows that I typically require my students to use and write unit tests on all of their projects (much to their disdain).</p> <p>Since another user had already suggested this, I thought it might be nice to look over their source code and point out a project specific example where a unit test could be written.</p> <h1 id="my-response">My Response</h1> <p>As I began to examine the code, it quickly became apparent that this code base was not in a state that could be unit tested.</p> <p>The main challenge was that the source code was split between two classes:</p> <p><strong>PrintBoard</strong> - Which contained logic for displaying the state of the chess board to the console.</p> <p>and…</p> <p><strong>Program</strong> - Which contained a single <strong>Main</strong> method which contained everything else (No judgement, we’ve all done it at some point).</p> <p>Without any “units” there are no “unit tests”.</p> <p>That said, the <strong>Main</strong> method did contain several locally defined function that I was hopeful could be pulled out and those methods might be testable.</p> <p>However, at this point, I felt that it might be more productive for <strong>/u/RayanWIP</strong> to focus their study on developing their Object Oriented skills rather than specifically digging into testing this code.</p> <p>With that in mind, I wrote my response:</p> <p><img src="/imgs/2022-11-23-ChessApp/my-response.png" alt="My Response" /></p> <h1 id="how-i-got-here">How I got here</h1> <p>It was inspiring to see a young programmer attempting to write a Chess program. There was a ton of good stuff happening in the code from a purely logical stand point. You could actually run the program and play a game of “hot-seat” Chess with another person.</p> <p>Here is the screen that comes up when you start the program:</p> <p><img src="/imgs/2022-11-23-ChessApp/chess-screenshot.png" alt="Chess Board" /></p> <p>With that in mind, I thought this could be a good opportunity to demonstrate how I might approach refactoring a messy code base. So, with <strong>u/RayanWIP</strong>’s permission, I recorded and live streamed myself working through the process in the hopes that I might be able to edit down the footage into something useful for my students.</p> <p>Although I do not recommend it, if you would like to watch me sweat my way through the entire 12 hours of refactoring, you can do so here: <a href="https://www.youtube.com/watch?v=ZAEtUKu3Q-4&amp;list=PLBdNYhNqW67lfpwfIJ1ne_l4cHtuAHU6g">YouTube Link</a></p> <h1 id="overview-of-the-refactor">Overview of the Refactor</h1> <p>The refactor consisted of 4 major parts, each of which had several smaller steps. I will start with a high level overview of each part here and then go into details in the subsequent sections.</p> <ol> <li> <p>Typically, one of the main goals of refactoring is to rewrite a program to be more manageable <strong>WITHOUT</strong> modifying the behavior. With this in mind, the first thing I created was an input / output test so I could give myself confidence that any modifications I made didn’t break the existing program.</p> </li> <li> <p>With a basic input / output test, I extracted all of the locally defined functions as static methods in an attempt to manage the complexity within the <strong>Main</strong> method as well as define a simplified “Game Loop”.</p> </li> <li> <p>With a somewhat manageable set of static methods, I moved on to removing repeated code by refactoring existing methods into a class hierarchy. This resulted in 3 main ideas: <code class="language-plaintext highlighter-rouge">GameState</code>, <code class="language-plaintext highlighter-rouge">IPiece</code>, and <code class="language-plaintext highlighter-rouge">AbstractPiece</code>. As well as 6 relatively concise subclasses: <code class="language-plaintext highlighter-rouge">PawnPiece</code>, <code class="language-plaintext highlighter-rouge">RookPiece</code>, <code class="language-plaintext highlighter-rouge">KnightPiece</code>, <code class="language-plaintext highlighter-rouge">BishopPiece</code>, <code class="language-plaintext highlighter-rouge">QueenPiece</code>, and <code class="language-plaintext highlighter-rouge">KingPiece</code>.</p> </li> <li> <p>In part 2, I begrudgingly introduced a handful of public global variables. With a solid OO design in place, I was finally able to delete the global state and add it “nicely” into the <code class="language-plaintext highlighter-rouge">GameState</code> class.</p> </li> </ol> <h1 id="part-1-building-an-input--output-test">Part 1: Building an Input / Output Test</h1> <p>Typically, one of the main goals of refactoring is to rewrite a program to be more manageable <strong>WITHOUT</strong> modifying the behavior. With this in mind, the first thing I created was an input / output test so I could give myself confidence that any modifications I made didn’t break the existing program.</p> <h2 id="the-plan">The Plan</h2> <p>Because the program accepts inputs from the keyboard and output text to the terminal, I thought it would be easy to “record” my inputs by writing them to a text file (<code class="language-plaintext highlighter-rouge">input.txt</code>) and store the program’s output in another text file (<code class="language-plaintext highlighter-rouge">output.txt</code>).</p> <p>With these two files, I would be able to feed any modified version of the program the “recorded” <code class="language-plaintext highlighter-rouge">input.txt</code> file and verify that the newly produced output matched the original <code class="language-plaintext highlighter-rouge">output.txt</code>.</p> <p>Simple enough, right? … right?</p> <h2 id="creating-input-tests">Creating Input Tests</h2> <p>To start out, I wrote a simple static <code class="language-plaintext highlighter-rouge">Utils</code> class that contained a <code class="language-plaintext highlighter-rouge">ReadLine()</code> method that would “record” inputs. Then, I replaced all calls to <code class="language-plaintext highlighter-rouge">Console.ReadLine()</code> with my <code class="language-plaintext highlighter-rouge">Utils.ReadLine()</code> method. Here is the method I came up with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">ReadLine</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">input</span> <span class="p">=</span> <span class="n">Console</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">()!;</span>
    <span class="n">StreamWriter</span> <span class="n">outputFile</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">AppendText</span><span class="p">(</span><span class="s">"temp_inputs.txt"</span><span class="p">);</span>
    <span class="n">outputFile</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
    <span class="n">outputFile</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">input</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>I then manually played through a very long, very boring, and very bad chess game in which I moved every piece at least once, tested bad inputs, and tried to find edge cases that were not implemented. This is an incredibly boring portion of the live stream that no one should ever endure.</p> <h2 id="replaying-the-game">Replaying the Game</h2> <p>After completing the game, I moved the <code class="language-plaintext highlighter-rouge">temp_inputs.txt</code> file containing all of the inputs to a file called <code class="language-plaintext highlighter-rouge">input_2.txt</code> (Yeah, I foolishly created an <code class="language-plaintext highlighter-rouge">input_1.txt</code> file by hand before writing my <code class="language-plaintext highlighter-rouge">Utils.ReadLine()</code> method).</p> <p>I then piped <code class="language-plaintext highlighter-rouge">input_2.txt</code> as input to the program:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ dotnet run &lt; input_2.txt
</code></pre></div></div> <p>It’s a little hard to see in the GIF below BUT this is the game playing itself as fast as my console can print it to the screen.</p> <p><img src="/imgs/2022-11-23-ChessApp/FastTest.gif" alt="Fast Test" /></p> <p>Woo-hoo! It worked! I now had a way to replay previously “recorded” games.</p> <h2 id="problems-creating-output-files">Problems Creating Output Files</h2> <p>Next, I tried to create an output file using the original code so I would have a baseline to compare all changes with. To do this, I ran the following command, which “pipes” all of the output to a file called <code class="language-plaintext highlighter-rouge">output_2.txt</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ dotnet run &lt; input_2.txt &gt;&gt; output_2.txt
</code></pre></div></div> <p>Unfortunately, this resulted in several exceptions related to unsupported console methods. In this case <code class="language-plaintext highlighter-rouge">Console.Clear()</code> and <code class="language-plaintext highlighter-rouge">Console.SetCursorPosition()</code> were not supported when piping to a file.</p> <p>I attempted to solve this by adding a few additional methods to the <code class="language-plaintext highlighter-rouge">Utils</code> class:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">TryClear</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">catch</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"\nCLEAR()\n"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SetCursorPosition</span><span class="p">(</span><span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">top</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">SetCursorPosition</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"\nSetCursorPosition(</span><span class="p">{</span><span class="n">left</span><span class="p">}</span><span class="s">,</span><span class="p">{</span><span class="n">top</span><span class="p">}</span><span class="s">)\n"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>At first, this seemed like it was going to work. Running the program and piping the output to <code class="language-plaintext highlighter-rouge">output_2.txt</code> did not result in any exceptions.</p> <p>However, simply running the command twice would sometimes result in differing files. The changes were mostly insignificant… extra whitespace / the order the cursor position was being set would be different. But this was enough that I knew this wouldn’t be reliable.</p> <p>I’m embarrassed to say that I wasn’t able to fix this issue and eventually gave up on the idea of comparing the original output with the modified output.</p> <p>Instead, I decided I would have to watch the game play in the terminal after each change and do my best to “eye-ball” the differences. I wasn’t happy with this but at least it was <strong>SOMETHING</strong> that would provide me with a small amount of confidence after each change.</p> <p>With that said, I am very happy I had this simple test as it did save me from myself against several failed refactors. Without it, I almost certainly would have spent hours trying to debug weird edge cases.</p> <h1 id="part-2-extracting-local-functions">Part 2: Extracting Local Functions</h1> <p>With the basic test available, the next step was to try and pull as much code as I could manage out of the 700-ish line <strong>Main</strong> method.</p> <p>While doing this, my goal was to identify duplicate code and portions that were candidates for abstraction / simplification.</p> <p>Starting at the top of the <strong>Main</strong> method I worked my way down. Each time I encountered a locally defined function, I would attempt to extract it as a static method.</p> <p>For example:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>

    <span class="c1">/// ... Code omitted for brevity</span>

    <span class="n">PrintBoard</span> <span class="n">changes</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PrintBoard</span><span class="p">();</span>

    <span class="kt">int</span><span class="p">[]</span> <span class="nf">indexselect</span><span class="p">(</span><span class="kt">string</span> <span class="k">select</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">7</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;=</span> <span class="m">7</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">==</span> <span class="k">select</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">array</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">array</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">j</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// ... Code omitted for brevity</span>
<span class="p">}</span>
</code></pre></div></div> <p>Was extracted to:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">static</span> <span class="n">PrintBoard</span> <span class="n">changes</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PrintBoard</span><span class="p">();</span>

<span class="k">private</span> <span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="nf">indexselect</span><span class="p">(</span><span class="kt">string</span> <span class="k">select</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="p">[]</span> <span class="n">array</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">int</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">7</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;=</span> <span class="m">7</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="p">==</span> <span class="k">select</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">array</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span> <span class="n">array</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>

    <span class="c1">/// ... Code omitted for brevity</span>

<span class="p">}</span>
</code></pre></div></div> <p>With each extraction, I would run my simple input / output test to verify the program was continuing to produce the same output.</p> <p>The majority of the locally defined functions could be easily extracted via a cut, paste, and adding the <code class="language-plaintext highlighter-rouge">static</code> keyword to the signature.</p> <p>In a few instances, there were local variables that were being used within and between multiple functions. This forced me to extract them as <code class="language-plaintext highlighter-rouge">static</code> variables, which made me feel a bit dirty. But, I kept a note in the back of my mind that they would be temporary and I would eventually remove them.</p> <p>Here were the methods and variables that were straight forward to extract:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Variables</span>
<span class="k">private</span> <span class="k">static</span> <span class="kt">int</span> <span class="n">DELAY</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">private</span> <span class="k">static</span> <span class="n">PrintBoard</span> <span class="n">changes</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PrintBoard</span><span class="p">();</span>
<span class="k">private</span> <span class="k">static</span> <span class="n">PrintBoard</span> <span class="n">movecheck</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PrintBoard</span><span class="p">();</span>
<span class="k">private</span> <span class="k">static</span> <span class="kt">string</span><span class="p">[,]</span> <span class="n">BoardLayout</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">string</span><span class="p">[</span><span class="m">8</span><span class="p">,</span> <span class="m">8</span><span class="p">];</span>
<span class="k">private</span> <span class="k">static</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">AddressList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
<span class="k">private</span> <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">Rows</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"1"</span><span class="p">,</span> <span class="s">"2"</span><span class="p">,</span> <span class="s">"3"</span><span class="p">,</span> <span class="s">"4"</span><span class="p">,</span> <span class="s">"5"</span><span class="p">,</span> <span class="s">"6"</span><span class="p">,</span> <span class="s">"7"</span><span class="p">,</span> <span class="s">"8"</span> <span class="p">};</span>
<span class="k">private</span> <span class="k">static</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">Columns</span> <span class="p">=</span> <span class="p">{</span> <span class="s">"A"</span><span class="p">,</span> <span class="s">"B"</span><span class="p">,</span> <span class="s">"C"</span><span class="p">,</span> <span class="s">"D"</span><span class="p">,</span> <span class="s">"E"</span><span class="p">,</span> <span class="s">"F"</span><span class="p">,</span> <span class="s">"G"</span><span class="p">,</span> <span class="s">"H"</span> <span class="p">};</span>

<span class="c1">// Methods</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">ClearCurrentConsoleLine</span><span class="p">();</span>
<span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="nf">indexselect</span><span class="p">(</span><span class="kt">string</span> <span class="k">select</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="nf">indextile</span><span class="p">(</span><span class="kt">string</span> <span class="n">tile</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">fillboardaddresses</span><span class="p">();</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">kingmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">kinglogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">pawnmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">pawnlogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">bishopmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">bishoplogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">rookmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">rooklogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">queenmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">queenlogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
</code></pre></div></div> <p>Unfortunately, at this point the main method was still quite long (200-ish lines) mostly due to a local function <code class="language-plaintext highlighter-rouge">tileselect()</code> which handled the logic for selecting the piece to move, displaying possible moves, selecting the position to move to, moving the piece, and checking if the game was finished.</p> <p>Extracting this method directly would require me to make several variables global. I was torn on what the best approach would be but ultimately decided to refactor this method into 4 smaller methods: <code class="language-plaintext highlighter-rouge">IsGameOver</code>, <code class="language-plaintext highlighter-rouge">PieceSelect</code>, <code class="language-plaintext highlighter-rouge">tileselect</code> and <code class="language-plaintext highlighter-rouge">MovePiece</code>.</p> <p>Here are the signatures of the methods I added / modified:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Checks if the game has ended and returns true if it has.</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsGameOver</span><span class="p">();</span>

<span class="c1">/// Prompts the user to select a piece to move.</span>
<span class="c1">/// Returns the selected piece and the row / col of that piece.</span>
<span class="k">static</span> <span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">address</span><span class="p">)</span> <span class="nf">PieceSelect</span><span class="p">();</span>

<span class="c1">/// Given a selected piece and starting location of that piece.</span>
<span class="c1">/// Prompts the user to select a tile to move to.</span>
<span class="k">static</span> <span class="kt">string</span> <span class="nf">tileselect</span><span class="p">(</span><span class="k">ref</span> <span class="kt">string</span> <span class="k">select</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">address</span><span class="p">);</span>

<span class="c1">/// Updates the board by putting a blank on the selected pieces location</span>
<span class="c1">/// and placing it in the tile. If a piece was in the tile, it is added to the deadpieces</span>
<span class="c1">/// list (captured).</span>
<span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">MovePiece</span><span class="p">(</span><span class="kt">string</span> <span class="k">select</span><span class="p">,</span> <span class="kt">string</span> <span class="n">tile</span><span class="p">)</span>
</code></pre></div></div> <p>I was not happy with my use of two reference parameters in the signature of the <code class="language-plaintext highlighter-rouge">tileselect</code> method. In my opinion, this was almost as bad as making them global variables… maybe worse.</p> <p>However, I was stubborn, did not want to add any more global variables, and was tired of my test failing. So, I gave in and made this concession to make it a little easier to get my input / output test to pass. I made a note of how much I hated this method signature and I promised myself I would come back to clean it up later.</p> <p>With these new changes, I was finally able to refactor the <strong>Main</strong> method to contain a relatively simple game loop:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">movecheck</span><span class="p">.</span><span class="nf">initialize</span><span class="p">();</span>
    <span class="n">changes</span><span class="p">.</span><span class="nf">initialize</span><span class="p">();</span>
    <span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
    <span class="nf">fillboardaddresses</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(!</span><span class="nf">IsGameOver</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">();</span>
        <span class="kt">string</span> <span class="k">select</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">address</span> <span class="p">=</span> <span class="nf">indexselect</span><span class="p">(</span><span class="k">select</span><span class="p">);</span>

        <span class="p">(</span><span class="k">select</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span> <span class="p">=</span> <span class="nf">PieceSelect</span><span class="p">();</span>
        <span class="kt">string</span> <span class="n">tile</span> <span class="p">=</span> <span class="nf">tileselect</span><span class="p">(</span><span class="k">ref</span> <span class="k">select</span><span class="p">,</span> <span class="k">ref</span> <span class="n">address</span><span class="p">);</span>

        <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
        <span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
        <span class="nf">MovePiece</span><span class="p">(</span><span class="k">select</span><span class="p">,</span> <span class="n">tile</span><span class="p">);</span>

        <span class="n">changes</span><span class="p">.</span><span class="n">turn</span><span class="p">++;</span>
        <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
        <span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h1 id="part-3-moving-to-an-object-oriented-design">Part 3: Moving to an Object Oriented Design</h1> <p>With all of the methods extracted, I was ready to start thinking about how I could leverage an Object Oriented design to remove repeated code and manage the complexity of the program.</p> <p>You may have noticed in the previous section there were several methods that had near identical signatures:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// These methods calculate and display the possible moves a piece can make given they are in the selected position.</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">kingmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">pawnmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">bishopmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">rookmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>
<span class="k">static</span> <span class="k">void</span> <span class="nf">queenmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">);</span>

<span class="c1">// These methods return true if a piece of the given type can move from</span>
<span class="c1">// selectindex to tileindex</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">kinglogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">pawnlogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">bishoplogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">rooklogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">bool</span> <span class="nf">queenlogic</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">,</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">tileindex</span><span class="p">);</span>
</code></pre></div></div> <p>These methods were used in a few places throughout the code, typically as part of a large branching set of <code class="language-plaintext highlighter-rouge">if</code> / <code class="language-plaintext highlighter-rouge">else if</code> / <code class="language-plaintext highlighter-rouge">else</code> statements.</p> <p>For example, after the player selects a piece, the program highlights the valid locations that piece can move.</p> <p>The section of code that does this can be seen below:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">string</span> <span class="nf">tileselect</span><span class="p">(</span><span class="k">ref</span> <span class="kt">string</span> <span class="k">select</span><span class="p">,</span> <span class="k">ref</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="k">true</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'p'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'P'</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nf">pawnmoves</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'q'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'Q'</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="nf">queenmoves</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'n'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'N'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//... }</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'B'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'b'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//... }</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'r'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'R'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//... }</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'K'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'k'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">//... }</span>

        <span class="c1">// omitted for brevity</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>When you see code like this, it is an indicator that you could be using inheritance and polymorphism to manage the complexity of selecting which method to perform.</p> <p>As soon as I saw this chunk of code, I knew that I wanted it to be refactored to something that looked like this:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IPiece</span> <span class="n">piece</span> <span class="p">=</span> <span class="nf">GetPiece</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
<span class="n">piece</span><span class="p">.</span><span class="nf">ShowMoves</span><span class="p">();</span>
</code></pre></div></div> <h2 id="the-ipiece-interface">The IPiece Interface</h2> <p>Before I could do this, I needed to define the interface <code class="language-plaintext highlighter-rouge">IPiece</code>. I knew I would need a method for <code class="language-plaintext highlighter-rouge">Logic</code> and <code class="language-plaintext highlighter-rouge">GetMoves</code> but, thinking a bit ahead, I also decided it would be useful to define a few additional properties.</p> <p>Here is the initial interface I came up with:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">interface</span> <span class="nc">IPiece</span>
<span class="p">{</span>
    <span class="c1">/// Given a position on the board, returns a list of possible moves</span>
    <span class="c1">/// that can be made by this IPiece.</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;</span> <span class="nf">GetMoves</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">);</span>

    <span class="c1">/// Given a starting position and a target position, returns true if the</span>
    <span class="c1">/// piece selected can perform such a move and false otherwise.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">startPos</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">targetPos</span><span class="p">);</span>

    <span class="c1">/// The 2 character string representing this IPiece on the board</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Symbol</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">/// The color of this IPiece</span>
    <span class="k">public</span> <span class="n">PieceColor</span> <span class="n">Color</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="c1">/// The position of this IPiece on the board.</span>
    <span class="k">public</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">Position</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>With the interface defined, I took a crack at creating a <code class="language-plaintext highlighter-rouge">PawnPiece</code> which implemented the <code class="language-plaintext highlighter-rouge">IPiece</code> interface.</p> <p>The constructor for <code class="language-plaintext highlighter-rouge">PawnPiece</code> allowed me to specify the Symbol, Color, and Position properties.</p> <p>Next, I copied the code from <code class="language-plaintext highlighter-rouge">pawnmoves</code> and <code class="language-plaintext highlighter-rouge">pawnlogic</code> into <code class="language-plaintext highlighter-rouge">PawnPiece.GetMoves</code> and <code class="language-plaintext highlighter-rouge">PawnPiece.Logic</code> and applied a few tweaks to make the compiler happy with my altered method signature:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Full source here: https://github.com/jcollard/Chessapp/blob/e298305bdefc7fd144dc1775b98c5f6a72b1f8ba/ConsoleApp9/Piece/PawnPiece.cs</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PawnPiece</span> <span class="p">:</span> <span class="n">IPiece</span>
<span class="p">{</span>

    <span class="c1">// properties omitted for brevity</span>

    <span class="k">public</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">PieceColor</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">position</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// initialize the properties</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;</span> <span class="nf">GetMoves</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// copy / pasted from `pawnmoves`</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// copy / pasted from `pawnlogic`</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Unfortunately, the <code class="language-plaintext highlighter-rouge">pawnmoves</code> and <code class="language-plaintext highlighter-rouge">pawnlogic</code> methods relied on a few of the static variables from the Main class. To appease my compiler, I made them public global variables. (Yuck…)</p> <p>Making note that I would eventually need to eliminate these global variables, I created a <code class="language-plaintext highlighter-rouge">GameState</code> class that I hoped would eventually serve as a non-static replacement.</p> <p>For now, it simply instantiated 16 pawns (8 for each side of the board) and provided access to them via a <code class="language-plaintext highlighter-rouge">GetPiece</code> method. For quick lookup, I utilized C#’s <code class="language-plaintext highlighter-rouge">Dictionary</code> class to map each pieces string symbol (e.g. “p1”, “P3”, “p5”, etc…) to the piece itself.</p> <p>Here is the GameState class at this point in the refactor:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">GameState</span>
<span class="p">{</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">IPiece</span><span class="p">&gt;</span> <span class="n">pieces</span> <span class="p">=</span> <span class="k">new</span> <span class="p">();</span>

    <span class="k">public</span> <span class="nf">GameState</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">8</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s">"p"</span> <span class="p">+</span> <span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="s">"p"</span> <span class="p">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">i</span><span class="p">-</span><span class="m">1</span><span class="p">));</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s">"P"</span> <span class="p">+</span> <span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="s">"P"</span> <span class="p">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="n">i</span><span class="p">-</span><span class="m">1</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">/// Given a symbol representing a piece, return an IPiece</span>
    <span class="c1">/// if it exists and null otherwise.</span>
    <span class="k">public</span> <span class="n">IPiece</span><span class="p">?</span> <span class="nf">GetPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pieces</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="k">out</span> <span class="n">IPiece</span><span class="p">?</span> <span class="k">value</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Finally, it was time to refactor any code that used <code class="language-plaintext highlighter-rouge">pawnlogic</code> or <code class="language-plaintext highlighter-rouge">pawnmoves</code> and delete those methods. The code segment that displayed possible moves became:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IPiece</span><span class="p">?</span> <span class="n">piece</span> <span class="p">=</span> <span class="n">gameState</span><span class="p">.</span><span class="nf">GetPiece</span><span class="p">(</span><span class="k">select</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">piece</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'q'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'Q'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// ... }</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'n'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'N'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// ... }</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'B'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'b'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// ... }</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'r'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'R'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// ... }</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'K'</span><span class="p">)</span> <span class="p">||</span> <span class="k">select</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'k'</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// ... }</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="n">piece</span><span class="p">.</span><span class="nf">GetMoves</span><span class="p">((</span><span class="n">address</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">address</span><span class="p">[</span><span class="m">1</span><span class="p">]));</span>
<span class="p">}</span>
</code></pre></div></div> <p>Again, with each change I ran the input / output test I created to give myself some confidence that I had not completely broken the program. And in several instances, I <strong>DID</strong> break something. Having this quick feedback allowed me to undo what I had just changed and try again.</p> <h2 id="the-abstractpiece-class">The AbstractPiece Class</h2> <p>Initially, I simply created an <code class="language-plaintext highlighter-rouge">IPiece</code> interface and wrote a single subclass <code class="language-plaintext highlighter-rouge">PawnPiece</code>. However, very early on, it became clear that there was a ton of duplicate code in the <code class="language-plaintext highlighter-rouge">moves</code> and <code class="language-plaintext highlighter-rouge">logic</code> methods. Here are two of the <code class="language-plaintext highlighter-rouge">move</code> methods from the original program:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="k">void</span> <span class="nf">kingmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">i</span> <span class="k">in</span> <span class="n">BoardLayout</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span> <span class="p">=</span> <span class="nf">indextile</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">kinglogic</span><span class="p">(</span><span class="n">selectindex</span><span class="p">,</span> <span class="n">arr</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="p">=</span> <span class="s">"XX"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="p">=</span> <span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
    <span class="n">movecheck</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="n">DELAY</span><span class="p">);</span>
    <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
    <span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">void</span> <span class="nf">bishopmoves</span><span class="p">(</span><span class="kt">int</span><span class="p">[]</span> <span class="n">selectindex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">i</span> <span class="k">in</span> <span class="n">BoardLayout</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span> <span class="p">=</span> <span class="nf">indextile</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nf">bishoplogic</span><span class="p">(</span><span class="n">selectindex</span><span class="p">,</span> <span class="n">arr</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="p">=</span> <span class="s">"XX"</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]]</span> <span class="p">=</span> <span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
    <span class="n">movecheck</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
    <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="n">DELAY</span><span class="p">);</span>
    <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
    <span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div> <p>Notice any similarities?</p> <p>With the exception of the names and a call to the associated <code class="language-plaintext highlighter-rouge">logic</code> method, they are identical. This means that we should do our best to reuse this code.</p> <p>To do this, I wrote an <code class="language-plaintext highlighter-rouge">AbstractPiece</code> class which implements <code class="language-plaintext highlighter-rouge">IPiece</code> and has a single <code class="language-plaintext highlighter-rouge">GetMoves</code> method.</p> <p>Here is the first version of the <code class="language-plaintext highlighter-rouge">AbstractPiece</code> class I wrote:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// full source here: https://github.com/jcollard/Chessapp/blob/d88aaaea97829c081eb54e6413df83259757feb2/ConsoleApp9/Piece/AbstractPiece.cs</span>
<span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">AbstractPiece</span> <span class="p">:</span> <span class="n">IPiece</span>
<span class="p">{</span>

    <span class="c1">// properties omitted for brevity</span>

    <span class="k">public</span> <span class="nf">AbstractPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">PieceColor</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">position</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_symbol</span> <span class="p">=</span> <span class="n">symbol</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_color</span> <span class="p">=</span> <span class="n">color</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_position</span> <span class="p">=</span> <span class="n">position</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;</span> <span class="nf">GetMoves</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;</span> <span class="n">moves</span> <span class="p">=</span> <span class="k">new</span> <span class="p">();</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">i</span> <span class="k">in</span> <span class="n">Program</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">int</span><span class="p">[]</span> <span class="n">arr</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="nf">indextile</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span> <span class="p">=</span> <span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">Logic</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Program</span><span class="p">.</span><span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">=</span> <span class="s">"XX"</span><span class="p">;</span>
                <span class="n">moves</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Program</span><span class="p">.</span><span class="n">movecheck</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
        <span class="n">Program</span><span class="p">.</span><span class="n">movecheck</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
        <span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="n">DELAY</span><span class="p">);</span>
        <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
        <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="nf">Print</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">moves</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">abstract</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">startPos</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">targetPos</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>Next, I refactored <code class="language-plaintext highlighter-rouge">PawnPiece</code> to extend <code class="language-plaintext highlighter-rouge">AbstractPiece</code>:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// full source here: https://github.com/jcollard/Chessapp/blob/d88aaaea97829c081eb54e6413df83259757feb2/ConsoleApp9/Piece/PawnPiece.cs</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PawnPiece</span> <span class="p">:</span> <span class="n">AbstractPiece</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">PieceColor</span> <span class="n">color</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">position</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// omitted for brevity</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Notice, the <code class="language-plaintext highlighter-rouge">PawnPiece</code> class is now incredibly short. I need only extend <code class="language-plaintext highlighter-rouge">AbstractPiece</code> and implement <code class="language-plaintext highlighter-rouge">Logic</code> to add a new type of piece to the program.</p> <p>With this in place, I created a class for each of the remaining 5 pieces by copying their associated <code class="language-plaintext highlighter-rouge">logic</code> method from the <strong>Main</strong> class. I did this one at a time, adding the appropriate instance to <code class="language-plaintext highlighter-rouge">GameState</code> and running the input / output test.</p> <p>Below is the version of <code class="language-plaintext highlighter-rouge">GameState</code> I had at this point:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// full source: https://github.com/jcollard/Chessapp/blob/b8acba73960a5798c55af48d017e32a985e88d5e/ConsoleApp9/GameState.cs</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GameState</span>
<span class="p">{</span>

    <span class="k">private</span> <span class="k">readonly</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">IPiece</span><span class="p">&gt;</span> <span class="n">pieces</span> <span class="p">=</span> <span class="k">new</span> <span class="p">();</span>

    <span class="k">public</span> <span class="nf">GameState</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="m">8</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s">"p"</span> <span class="p">+</span> <span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="s">"p"</span> <span class="p">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">i</span><span class="p">-</span><span class="m">1</span><span class="p">));</span>
            <span class="n">pieces</span><span class="p">[</span><span class="s">"P"</span> <span class="p">+</span> <span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">PawnPiece</span><span class="p">(</span><span class="s">"P"</span> <span class="p">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="n">i</span><span class="p">-</span><span class="m">1</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"k1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KingPiece</span><span class="p">(</span><span class="s">"k1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">3</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"K1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KingPiece</span><span class="p">(</span><span class="s">"K1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">4</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"q1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">QueenPiece</span><span class="p">(</span><span class="s">"q1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">4</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"Q1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">QueenPiece</span><span class="p">(</span><span class="s">"Q1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">3</span><span class="p">));</span>

        <span class="n">pieces</span><span class="p">[</span><span class="s">"n1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KnightPiece</span><span class="p">(</span><span class="s">"n1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"N1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KnightPiece</span><span class="p">(</span><span class="s">"N1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">1</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"n2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KnightPiece</span><span class="p">(</span><span class="s">"n2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">6</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"N2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">KnightPiece</span><span class="p">(</span><span class="s">"N2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">6</span><span class="p">));</span>

        <span class="n">pieces</span><span class="p">[</span><span class="s">"b1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BishopPiece</span><span class="p">(</span><span class="s">"b1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">2</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"B1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BishopPiece</span><span class="p">(</span><span class="s">"B1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">2</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"b2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BishopPiece</span><span class="p">(</span><span class="s">"b2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">5</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"B2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BishopPiece</span><span class="p">(</span><span class="s">"B2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">5</span><span class="p">));</span>

        <span class="n">pieces</span><span class="p">[</span><span class="s">"r1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RookPiece</span><span class="p">(</span><span class="s">"r1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"R1"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RookPiece</span><span class="p">(</span><span class="s">"R1"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"r2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RookPiece</span><span class="p">(</span><span class="s">"r2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">,</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">7</span><span class="p">));</span>
        <span class="n">pieces</span><span class="p">[</span><span class="s">"R2"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">RookPiece</span><span class="p">(</span><span class="s">"R2"</span><span class="p">,</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span><span class="p">,</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="m">7</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IPiece</span> <span class="nf">GetPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pieces</span><span class="p">.</span><span class="nf">TryGetValue</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="k">out</span> <span class="n">IPiece</span><span class="p">?</span> <span class="k">value</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">value</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"The symbol </span><span class="p">{</span><span class="n">symbol</span><span class="p">}</span><span class="s"> is not a valid piece on this board."</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>One thing to note in the code above is that <code class="language-plaintext highlighter-rouge">GetPiece</code> no longer returns a <strong>nullable</strong> <code class="language-plaintext highlighter-rouge">IPiece</code>. With all of the pieces now in the <code class="language-plaintext highlighter-rouge">GameState</code>, I decided it was appropriate to throw an exception if an invalid symbol was passed to <code class="language-plaintext highlighter-rouge">GetPiece</code>.</p> <p>The resulting code for showing the possible moves a piece can make was now reduced to two lines and 0 if statements:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IPiece</span> <span class="n">piece</span> <span class="p">=</span> <span class="n">gameState</span><span class="p">.</span><span class="nf">GetPiece</span><span class="p">(</span><span class="k">select</span><span class="p">);</span>
<span class="n">piece</span><span class="p">.</span><span class="nf">GetMoves</span><span class="p">((</span><span class="n">address</span><span class="p">[</span><span class="m">0</span><span class="p">],</span> <span class="n">address</span><span class="p">[</span><span class="m">1</span><span class="p">]));</span>
</code></pre></div></div> <p>Not bad!</p> <p>Additionally, I was able to delete all of the <code class="language-plaintext highlighter-rouge">moves</code> and <code class="language-plaintext highlighter-rouge">logic</code> methods from the <strong>Main</strong> class.</p> <h2 id="refactoring-logic-checks">Refactoring Logic Checks</h2> <p>While copying each of the <code class="language-plaintext highlighter-rouge">logic</code> methods into the appropriate subclass of <code class="language-plaintext highlighter-rouge">AbstractPiece</code>, I noticed that all of them began with the exact same check:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">==</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">ToUpper</span><span class="p">()</span> <span class="p">&amp;&amp;</span>
        <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">==</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">ToUpper</span><span class="p">()</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">==</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">ToLower</span><span class="p">()</span> <span class="p">&amp;&amp;</span>
        <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">]</span> <span class="p">==</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">ToLower</span><span class="p">()</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// differing code follows ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>After spending some time working through this logic, it turns out that this check is ensuring that a piece cannot move into spaces occupied by pieces of the same color.</p> <p>To help manage this, I added two helper methods.</p> <ul> <li><code class="language-plaintext highlighter-rouge">GameState.IsEmpty</code> which checks if a space is not occupied</li> <li><code class="language-plaintext highlighter-rouge">IPiece.IsEnemy</code> which checks if a piece is an enemy piece</li> </ul> <p>This allowed me to refactor the code above to:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">target</span><span class="p">,</span> <span class="n">GameState</span> <span class="n">gameState</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(!</span><span class="n">gameState</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="k">this</span><span class="p">.</span><span class="nf">IsEnemyPiece</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">gameState</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">/// differing code follows ...</span>
<span class="p">}</span>
</code></pre></div></div> <p>Notice that I did alter the signature of <code class="language-plaintext highlighter-rouge">Logic</code> to accept a <code class="language-plaintext highlighter-rouge">GameState</code> object. I felt this was okay as it made the condition here easier to understand.</p> <p>Additionally, the logic for <code class="language-plaintext highlighter-rouge">IsEmpty</code> and <code class="language-plaintext highlighter-rouge">IsEnemyPiece</code> were relatively simple:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// In GameState</span>
<span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsEmpty</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">targetSymbol</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">pos</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">pos</span><span class="p">.</span><span class="n">col</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">targetSymbol</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// In AbstractPiece</span>
<span class="k">protected</span> <span class="kt">bool</span> <span class="nf">IsEnemyPiece</span><span class="p">(</span><span class="n">IPiece</span> <span class="n">other</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">other</span><span class="p">.</span><span class="n">Color</span> <span class="p">!=</span> <span class="k">this</span><span class="p">.</span><span class="n">Color</span><span class="p">;</span>

<span class="c1">// This method uses global state to extract the piece at a given position</span>
<span class="c1">// by finding its string symbol on the board.</span>
<span class="k">protected</span> <span class="kt">bool</span> <span class="nf">IsEnemyPiece</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">,</span> <span class="n">GameState</span> <span class="n">gameState</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">targetSymbol</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">gameState</span><span class="p">.</span><span class="nf">TryGetPiece</span><span class="p">(</span><span class="n">targetSymbol</span><span class="p">,</span> <span class="k">out</span> <span class="n">IPiece</span><span class="p">?</span> <span class="n">other</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nf">IsEnemyPiece</span><span class="p">(</span><span class="n">other</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>With this change in place, I still had the generic check at the start of each <code class="language-plaintext highlighter-rouge">Logic</code> method. So, I decided to move this check into <code class="language-plaintext highlighter-rouge">AbstractPiece.Logic</code> and provide an abstract <code class="language-plaintext highlighter-rouge">SubLogic</code> method that each sub class would implement. The idea here is that all common checks should go in <code class="language-plaintext highlighter-rouge">AbstractPiece.Logic</code> and any piece-specific checks should be implemented in the subclasses <code class="language-plaintext highlighter-rouge">SubLogic</code> method.</p> <p>Here is the final <code class="language-plaintext highlighter-rouge">AbstractPiece.Logic</code> method:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Full source here: https://github.com/jcollard/Chessapp/blob/master/ConsoleApp9/Piece/AbstractPiece.cs</span>

<span class="k">public</span> <span class="kt">bool</span> <span class="nf">Logic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Pieces cannot move onto themselves</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span> <span class="p">==</span> <span class="n">target</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Cannot capture pieces of the same color</span>
    <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="k">this</span><span class="p">.</span><span class="nf">IsEnemyPiece</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">GetPiece</span><span class="p">(</span><span class="n">target</span><span class="p">)!))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nf">SubLogic</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// Given a target position, checks the piece specific logic for moving this</span>
<span class="c1">/// piece to that position on the board. If the piece can move there,</span>
<span class="c1">/// returns true and otherwise returns false.</span>
<span class="k">protected</span> <span class="k">abstract</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">targetPos</span><span class="p">);</span>
</code></pre></div></div> <p>An important thing to note here is that <code class="language-plaintext highlighter-rouge">SubLogic</code> is not defined in <code class="language-plaintext highlighter-rouge">IPiece</code> and is a <code class="language-plaintext highlighter-rouge">protected</code> method which allows it to be implemented by a subclass.</p> <h2 id="refactoring-sublogic-for-each-piece">Refactoring SubLogic for each Piece</h2> <p>In the original program, each piece’s logic was a challenge for me to read and understand. I spent a good amount of time reasoning through what each branch of logic was doing. It was quite painful and I felt I should attempt to simplify the logic for each subclass.</p> <p><strong>Note</strong>: I was trying to refactor the code to function identical to the original program. Because of this, I intentionally did not implement a handful of rules that would be present in a full version of chess. For example, the original version did not check for moves that put a player in “Check” thus, it allows players to move into “Check” and allows players to move when they would be in a “Check Mate” situation.</p> <p>Below is how I refactored each piece:</p> <h3 id="king">King</h3> <p>The King can move into any adjacent space both orthogonally and diagonally. In the original program <strong>u/RayanWIP</strong> did not allow for castling and did not prevent the player from moving into check so I didn’t add these in.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Original:</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span>
        <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span>
             <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">&amp;&amp;</span>
             <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Because I made <code class="language-plaintext highlighter-rouge">Abstract.Logic</code> ensure that a piece cannot move into the space it is occupying, I was able to refactor <code class="language-plaintext highlighter-rouge">SubLogic</code> to calculate the distance moved on the row and column and simply check that both were at most 1.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Refactored</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
        <span class="kt">int</span> <span class="n">rowDist</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">colDist</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">rowDist</span> <span class="p">&lt;=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">colDist</span> <span class="p">&lt;=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div></div> <h3 id="knight">Knight</h3> <p>The knight moves in an “L” shape on the board and can “hop” over pieces. This means that it must move 2 spaces in one direction and 1 space in the other (a total of 3 spaces).</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Original logic</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">player</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">][</span><span class="m">0</span><span class="p">];</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">==</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">!=</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">!=</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">)</span> <span class="p">!=</span> <span class="m">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Similar to the King logic, I calculate the rows and columns moved. Then, use the knowledge that one of those values must be 1 and the sum of them must be 3 to eliminate the if statements:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Refactored logic</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rowDist</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">colDist</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">rowDist</span> <span class="p">==</span> <span class="m">1</span> <span class="p">||</span> <span class="n">colDist</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
            <span class="n">rowDist</span> <span class="p">+</span> <span class="n">colDist</span> <span class="p">==</span> <span class="m">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="rook-bishop-and-queen">Rook, Bishop, and Queen</h3> <p>The Rook, Bishop, and Queen shared similar logic so I’ve lumped them together here.</p> <p>More specifically, these pieces can move many spaces on the board orthogonally or diagonally as long as they don’t “jump” over another piece. To help with this, I wrote a helper method <code class="language-plaintext highlighter-rouge">IsPathClear</code> which takes in two positions and checks if the path between them is empty.</p> <p>Additionally, I wrote two more helpers <code class="language-plaintext highlighter-rouge">IsDiagonal</code> and <code class="language-plaintext highlighter-rouge">IsOrthogonal</code> which determine if two positions are diagonal or orthogonal to each other.</p> <p>This allowed for each of the <code class="language-plaintext highlighter-rouge">SubLogic</code> methods to be drastically simplified:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// RookPiece</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">Utils</span><span class="p">.</span><span class="nf">IsOrthogonal</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsPathClear</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// BishopPiece</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">Utils</span><span class="p">.</span><span class="nf">IsDiagonal</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsPathClear</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// QueenPiece</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">Utils</span><span class="p">.</span><span class="nf">IsDiagonal</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">Utils</span><span class="p">.</span><span class="nf">IsOrthogonal</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsPathClear</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Position</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="pawn">Pawn</h3> <p>The pawn is probably the most complex piece in the game as it has several conditional rules for movement:</p> <ol> <li>Typically, it can only move forward one space. BUT it cannot attack forward.</li> <li>If a piece is occupying a space diagonally in front of it, it can capture it by moving diagonally.</li> <li>Also, for its first move, it may move 2 spaces forward. However, when it does this it cannot “hop” over a piece and cannot capture a piece.</li> <li>If the pawn makes it to the far end of the board, it is promoted to a Rook, Bishop, Knight, or Queen.</li> <li>Also, there is a rule called “En Passant” that allows the pawn to capture another pawn that passed it under specific circumstances: <a href="https://www.chess.com/terms/en-passant">Full Rules at Chess.com</a></li> </ol> <p>Lucky for me, <strong>u/RayanWIP</strong> didn’t implement 4 or 5 so I “safely” ignored them in my refactor.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Original Code</span>
<span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">char</span> <span class="n">player</span> <span class="p">=</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">start</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span><span class="p">][</span><span class="m">0</span><span class="p">];</span>


    <span class="k">if</span> <span class="p">(</span><span class="kt">char</span><span class="p">.</span><span class="nf">ToUpper</span><span class="p">(</span><span class="n">player</span><span class="p">)</span> <span class="p">==</span> <span class="n">player</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">6</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">+</span> <span class="m">1</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">pieces</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="p">-</span><span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="p">-</span><span class="m">2</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="m">0</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">'X'</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">==</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">].</span><span class="nf">Contains</span><span class="p">(</span><span class="sc">' '</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Abs</span><span class="p">(</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span> <span class="p">&amp;&amp;</span> <span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">pieces</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">Program</span><span class="p">.</span><span class="n">changes</span><span class="p">.</span><span class="n">BoardLayout</span><span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="n">row</span><span class="p">,</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">]))</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>I struggled quite a bit trying to refactor this code in a way that didn’t feel difficult to read. In fact, I still feel my “simplified” version is quite challenging to understand. Ultimately, I wrote 3 if statements which determine if the conditions for 1, 2, or 3, above were met.</p> <p>Here is my sad attempt:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">override</span> <span class="kt">bool</span> <span class="nf">SubLogic</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">rowInc</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Color</span> <span class="p">==</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">targetRow</span> <span class="p">=</span> <span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">+</span> <span class="n">rowInc</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">firstTurnTargetRow</span> <span class="p">=</span> <span class="n">start</span><span class="p">.</span><span class="n">row</span> <span class="p">+</span> <span class="m">2</span><span class="p">*</span><span class="n">rowInc</span><span class="p">;</span>
    <span class="kt">int</span><span class="p">[]</span> <span class="n">targetCols</span> <span class="p">=</span> <span class="p">{</span><span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="m">1</span><span class="p">,</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">+</span> <span class="m">1</span><span class="p">};</span>
    <span class="kt">bool</span> <span class="n">isAttack</span> <span class="p">=</span> <span class="n">start</span><span class="p">.</span><span class="n">col</span> <span class="p">-</span> <span class="n">target</span><span class="p">.</span><span class="n">col</span> <span class="p">!=</span> <span class="m">0</span><span class="p">;</span>

    <span class="c1">// Always, pawn may move forward 1 if space is empty</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="n">targetRow</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="n">isAttack</span> <span class="p">&amp;&amp;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// On first turn, pawn may move forward 2 spaces if empty</span>
    <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">HasMoved</span> <span class="p">&amp;&amp;</span>
        <span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="n">firstTurnTargetRow</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="n">isAttack</span> <span class="p">&amp;&amp;</span> 
        <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsPathClear</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Can move diagonal 1 if an enemy is in that space</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">row</span> <span class="p">==</span> <span class="n">targetRow</span> <span class="p">&amp;&amp;</span>
        <span class="n">targetCols</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">col</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="p">!</span><span class="k">this</span><span class="p">.</span><span class="n">_gameState</span><span class="p">.</span><span class="nf">IsEmpty</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Perhaps some day if I’m feeling up to it, I might try to refactor this logic again to be more readable. But, this was the best I could do at the time.</p> <h1 id="part-4-removing-global-variables">Part 4: Removing Global Variables</h1> <p>Having refactored all of the <code class="language-plaintext highlighter-rouge">SubLogic</code> methods to have no references to global state, I really wanted to remove the global variables from the <strong>Main</strong> class.</p> <p>This involved selecting each of the global variables and slowly eliminating all references to them throughout the code base and replacing them with a call to an instance of <code class="language-plaintext highlighter-rouge">GameState</code>. As I did this, I added necessary methods and logic to the <code class="language-plaintext highlighter-rouge">GameState</code> class. Below is the <code class="language-plaintext highlighter-rouge">GameState</code> API after removing all global state.</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Full Source: https://github.com/jcollard/Chessapp/blob/master/ConsoleApp9/GameState.cs</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GameState</span>
<span class="p">{</span>
    <span class="c1">/// Constructs a GameState in a traditional chess layout.</span>
    <span class="k">public</span> <span class="nf">GameState</span><span class="p">();</span>

    <span class="c1">/// Given a starting and target position that are orthogonal or diagonal to each</span>
    <span class="c1">/// other, returns true if no pieces are found between them and false otherwise.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsPathClear</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">start</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">);</span>

    <span class="c1">/// Returns the piece at the specified position or null if no piece is at that</span>
    <span class="c1">/// position.</span>
    <span class="k">public</span> <span class="n">IPiece</span><span class="p">?</span> <span class="nf">GetPiece</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">);</span>

    <span class="c1">/// Returns true if there is no piece at the specified position and false otherwise.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsEmpty</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">);</span>

    <span class="c1">/// Given a symbol name for a piece, checks if that piece</span>
    <span class="c1">/// exists in this GameState. If that piece exists, sets</span>
    <span class="c1">/// the value of piece and returns true. Otherwise, returns false.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">TryGetPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">,</span> <span class="k">out</span> <span class="n">IPiece</span> <span class="n">piece</span><span class="p">);</span>

    <span class="c1">/// Given a symbol name for a piece, returns the associated IPiece.</span>
    <span class="c1">/// If no such piece is on the board, throw an ArgumentException.</span>
    <span class="k">public</span> <span class="n">IPiece</span> <span class="nf">GetPiece</span><span class="p">(</span><span class="kt">string</span> <span class="n">symbol</span><span class="p">);</span>

    <span class="c1">/// Checks if the game has ended and returns true if it has.</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsGameOver</span><span class="p">();</span>

    <span class="c1">/// Returns the color of the active player</span>
    <span class="k">public</span> <span class="n">PieceColor</span> <span class="nf">GetActivePlayer</span><span class="p">();</span>

    <span class="c1">/// Prints the underlying board to the screen.</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">PrintBoard</span><span class="p">();</span>

    <span class="c1">/// Given a list of positions, displays them as possible moves</span>
    <span class="c1">/// on the screen.</span>
    <span class="k">internal</span> <span class="k">void</span> <span class="nf">DisplayPossibleMoves</span><span class="p">(</span><span class="n">List</span><span class="p">&lt;(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)&gt;</span> <span class="n">moves</span><span class="p">);</span>

    <span class="c1">/// Adds the specified move to the GameState history</span>
    <span class="k">internal</span> <span class="k">void</span> <span class="nf">AddMove</span><span class="p">(</span><span class="n">IPiece</span> <span class="n">piece</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">target</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="n">moves</span><span class="p">.</span><span class="nf">Add</span><span class="p">((</span><span class="n">piece</span><span class="p">,</span> <span class="n">target</span><span class="p">));</span>

    <span class="c1">/// Given a position on the board, sets the piece, overriding any piece that may already be there.</span>
    <span class="k">internal</span> <span class="k">void</span> <span class="nf">SetPiece</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">,</span> <span class="n">IPiece</span> <span class="n">piece</span><span class="p">);</span>

    <span class="c1">/// Removes a piece, if it exists, from the specified location on the board</span>
    <span class="k">internal</span> <span class="k">void</span> <span class="nf">ClearPiece</span><span class="p">((</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>And finally, the <strong>Main</strong> class:</p> <div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// Full source: https://github.com/jcollard/Chessapp/blob/master/ConsoleApp9/Program.cs</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Program</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">DELAY</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Rows</span> <span class="p">=</span> <span class="s">"12345678"</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">Columns</span> <span class="p">=</span> <span class="s">"ABCDEFGH"</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">readonly</span> <span class="k">static</span> <span class="n">GameState</span> <span class="n">gameState</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GameState</span><span class="p">();</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">while</span> <span class="p">(!</span><span class="n">gameState</span><span class="p">.</span><span class="nf">IsGameOver</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
            <span class="n">gameState</span><span class="p">.</span><span class="nf">PrintBoard</span><span class="p">();</span>

            <span class="n">IPiece</span> <span class="n">piece</span> <span class="p">=</span> <span class="nf">PieceSelect</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(!</span><span class="nf">TryTileSelect</span><span class="p">(</span><span class="n">piece</span><span class="p">,</span> <span class="k">out</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="n">targetPos</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">piece</span><span class="p">.</span><span class="nf">Move</span><span class="p">(</span><span class="n">targetPos</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">Utils</span><span class="p">.</span><span class="nf">TryClear</span><span class="p">();</span>
        <span class="n">gameState</span><span class="p">.</span><span class="nf">PrintBoard</span><span class="p">();</span>
        <span class="n">PieceColor</span> <span class="n">winner</span> <span class="p">=</span> <span class="n">gameState</span><span class="p">.</span><span class="nf">GetActivePlayer</span><span class="p">()</span> <span class="p">==</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span> <span class="p">?</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Green</span> <span class="p">:</span> <span class="n">PieceColor</span><span class="p">.</span><span class="n">Blue</span><span class="p">;</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"</span><span class="p">{</span><span class="n">winner</span><span class="p">}</span><span class="s"> is the winner!"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/// Displays an error message to the user.</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">DisplayError</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">);</span>

    <span class="c1">/// Prompts the user to select a piece to move. Returns the selected piece and the row / col of that piece.</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">IPiece</span> <span class="nf">PieceSelect</span><span class="p">();</span>

    <span class="c1">/// Prompts the user to enter a tile position.</span>
    <span class="c1">/// Returns true</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">TryGetTile</span><span class="p">(</span><span class="k">out</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">pos</span><span class="p">);</span>

    <span class="c1">/// Given a piece, prompts the user to select a tile to move to or to type</span>
    <span class="c1">/// "BACK". If the user types back, this method return false. Otherwise,</span>
    <span class="c1">/// it returns true and the target parameter is set to the users choice.</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">bool</span> <span class="nf">TryTileSelect</span><span class="p">(</span><span class="n">IPiece</span> <span class="n">piece</span><span class="p">,</span> <span class="k">out</span> <span class="p">(</span><span class="kt">int</span> <span class="n">row</span><span class="p">,</span> <span class="kt">int</span> <span class="n">col</span><span class="p">)</span> <span class="n">target</span><span class="p">);</span>

    <span class="c1">/// Given a two character string of a position on the board, return</span>
    <span class="c1">/// its associated row, col values.</span>
    <span class="k">private</span> <span class="k">static</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="nf">BoardPosToIndex</span><span class="p">(</span><span class="kt">string</span> <span class="n">tile</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <h1 id="last-thoughts--whats-next">Last Thoughts / What’s next?</h1> <p>Well… that’s it! I refactored a Chess program in C# to use an Object Oriented design. It was a really fun experiment and I’m hoping to rework some version of this into a class project / practice exercise for future courses.</p> <p>It really is a tough skill to learn and apply but you can end up with something that is much more maintainable without the need to start over from scratch.</p> <p>The main goal here was to create a program that could be unit tested and it should be noted here that there are MANY more methods than the original project. However, each method is much smaller and (hopefully) easier to understand. These are the “units” that can now be tested.</p> <p>So… I guess the next step would be to write a test suite of unit tests. But, I’ll leave that for another time.</p> <p>I hope someone gets some use out of this.</p> <p>Until next time!</p> </div> <hr/> <h2>Join the Discussion on Reddit</h2> <iframe id="reddit-embed" src="https://www.redditmedia.com/r/csharp/comments/z1uiir/refactoring_a_chess_program_to_use_an_object/?ref_source=embed&amp;ref=share&amp;embed=true&amp;showmedia=false" sandbox="allow-scripts allow-same-origin allow-popups" style="border: none;" height="126" width="640" scrolling="no"></iframe> </article> </div> </main> <footer id="site-footer"> <div class="container"> <div class="h5 pt-4">World&#39;s Worst Blog</div> <div class="row"> <div class="col col-lg-3"> <ul class="list-unstyled"> <li class="text-secondary"> World&#39;s Worst Blog </li> </ul> </div> <div class="col-12 col-lg"> <p class="text-secondary text-justify">Musings, tutorials, and ramblings by Captain Coder!</p> </div> </div> </div> </footer> </body> </html>
